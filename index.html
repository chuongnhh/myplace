<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>My Place</title>
</head>

<body>
    <p id="messages">Hello world! I'm chuongnh!</p>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script>
        $(function () {
            //var socket = io('http://sharemyplace.azurewebsites.net/');
            var socket = io();
            socket.on('emit_message', function (msg) {
                $('#messages').append($('<li>').html(msg['id'] + '<br>lat: ' + msg['lat'] + ', lng: ' + msg['lng'] + '<br>' + msg['address']));
                $(document).scrollTop($(document).height());
            });
            socket.on('conect_message', function (msg) {
                $('#messages').append($('<li>').html(msg));
                $(document).scrollTop($(document).height());
            });

            setInterval(function () {
                socket.emit('on_message', { id: 'chuongnh', lat: 1.0, lng: 2.0, address: 'unknown' });
            }, 1000);


            // map
        });
    </script>

    <script>
        // Note: This example requires that you consent to location sharing when
        // prompted by your browser. If you see the error "The Geolocation service
        // failed.", it means you probably did not give permission for the browser to
        // locate you.
        var map, infoWindow;
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: -34.397, lng: 150.644 },
                zoom: 6
            });
            infoWindow = new google.maps.InfoWindow;

            // Try HTML5 geolocation.
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    var pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    socket.emit('on_message', { id: 'chuongnh', lat: position.coords.latitude, lng: position.coords.longitude, address: 'unknown' });

                    // infoWindow.setPosition(pos);
                    // infoWindow.setContent('Location found.');
                    // infoWindow.open(map);
                    // map.setCenter(pos);
                }, function () {
                    handleLocationError(true, infoWindow, map.getCenter());
                });
            } else {
                // Browser doesn't support Geolocation
                handleLocationError(false, infoWindow, map.getCenter());
            }
        }

        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
            // infoWindow.setPosition(pos);
            // infoWindow.setContent(browserHasGeolocation ?
            //     'Error: The Geolocation service failed.' :
            //     'Error: Your browser doesn\'t support geolocation.');
            // infoWindow.open(map);
        }
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBLB5XU5PNZrSImGhCpm2kfnRxLyCkc7W4&callback=initMap">

    </script>

</body>

</html>